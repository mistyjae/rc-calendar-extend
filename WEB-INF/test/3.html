<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta http-equiv="description" content="canvas实现图片旋转效果 >> 张鑫旭-鑫空间-鑫生活"/>
    <meta name="description" content="张鑫旭web前端学习之css"/>
    <meta name="keywords" content="张鑫旭,鑫空间-鑫生活,博客,web前端,css,demo页面,学习"/>
    <meta name="author" content="张鑫旭,zhangxixnu"/>
    <title>canvas实现图片的左右旋转效果 &gt;&gt; 张鑫旭-鑫空间-鑫生活</title>
    <link rel="shortcut icon" href="http://www.zhangxinxu.com/zxx_ico.png"/>
    <link rel="stylesheet" href="../css/common.css" type="text/css"/>
    <style type="text/css">
        .rot_box {
            width: 512px;
            margin: 0 auto;
        }

        .image_box {
            text-align: center;
        }

        .image_box img {
            margin-top: -150px;
        }
    </style>
    <!--[if IE]>
    <script type="text/javascript" src="../js/excanvas.js"></script><![endif]-->
    <script type="text/javascript">
        window.onload = function () {
            var param = {
                right: document.getElementById("rotRight"),
                left: document.getElementById("rotLeft"),
                img: document.getElementById("rotImg"),
                cv: document.getElementById("canvas"),
                rot: 0
            };
            var rotate = function (canvas, img, rot) {
                //获取图片的高宽
                var w = img.width;
                var h = img.height;
                //角度转为弧度
                if (!rot) {
                    rot = 0;
                }
                var rotation = Math.PI * rot / 180;
                var c = Math.round(Math.cos(rotation) * 1000) / 1000;
                var s = Math.round(Math.sin(rotation) * 1000) / 1000;
                //旋转后canvas标签的大小
                canvas.height = Math.abs(c * h) + Math.abs(s * w);
                canvas.width = Math.abs(c * w) + Math.abs(s * h);
                //绘图开始
                var context = canvas.getContext("2d");
                context.save();
                //改变中心点
                if (rotation <= Math.PI / 2) {
                    context.translate(s * h, 0);
                } else if (rotation <= Math.PI) {
                    context.translate(canvas.width, -c * h);
                } else if (rotation <= 1.5 * Math.PI) {
                    context.translate(-c * w, canvas.height);
                } else {
                    context.translate(0, -s * w);
                }
                //旋转90°
                let temp1 = context.rotate(rotation);
                //绘制
                let temp2 = context.drawImage(img, 0, 0, w, h);
                context.restore();
                img.style.display = "none";
            }
            var fun = {
                right: function () {
                    param.rot += 90;
                    rotate(param.cv, param.img, param.rot);
                    if (param.rot === 270) {
                        param.rot = -90;
                    }
                },
                left: function () {
                    param.rot -= 90;
                    if (param.rot === -90) {
                        param.rot = 270;
                    }
                    rotate(param.cv, param.img, param.rot);
                }
            };
            param.right.onclick = function () {
                fun.right();
                var url = getFileUrl("imgOne");
                console.log("=================================");
                console.log(url);
                return false;
            };
            param.left.onclick = function () {
                fun.left();
                var url = getFileUrl("imgOne");
                console.log("=================================");
                console.log(url);
                return false;
            };
        };
        function getFileUrl(sourceId) {
            var url;
            if (navigator.userAgent.indexOf("MSIE") >= 1) { // IE
                url = document.getElementById(sourceId).value;
            } else if (navigator.userAgent.indexOf("Firefox") > 0) { // Firefox
                url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));
            } else if (navigator.userAgent.indexOf("Chrome") > 0) { // Chrome
                url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));
            }
            return url;
        }
        function preImg(sourceId, targetId) {
            var url = getFileUrl(sourceId);
            var imgPre = document.getElementById(targetId);
            imgPre.src = url;
        }
        function objectImg(sourceId, targetId) {
            var url = getFileUrl(sourceId);
            console.log("=================================");
            console.log(url);
        }
    </script>
</head>

<body>
<div class="zxx_out_box">
    <div class="zxx_in_box">
        <div class="zxx_header">
            <a href="http://www.zhangxinxu.com/">
                <img class="l"
                     src="http://www.zhangxinxu.com/wordpress/wp-content/themes/default/images/index_logo.gif"/>
            </a>
            <span class="zxx_author_time">by zhangxinxu 2010-01-11 23:07</span>
        </div>
        <h1 class="zxx_title">canvas实现图片旋转效果</h1>

        <div class="zxx_main_con">
            <div class="zxx_test_list">
                <div class="rot_box">
                    <p class="fix f9 mb10"><a id="rotLeft" class="l" href="javascript:void(0);">&lt;&lt;向左转</a><a
                            id="rotRight" class="r" href="javascript:void(0);">向右转&gt;&gt;</a></p>

                    <div class="image_box">
                        <canvas id="canvas"></canvas>
                        <input type="file" multiple="multiple" name="imgOne" id="imgOne"
                               onchange="preImg(this.id,'rotImg');"/>
                        <img id="rotImg" src="" style="display: block;"/>
                    </div>
                </div>
            </div>
        </div>
        <div class="zxx_footer">
            Copyright &copy; by <a href="http://www.zhangxinxu.com/">张鑫旭-鑫空间-鑫生活</a>
            |
            <a href="http://www.zhangxinxu.com/wordpress/?p=552">该篇相关文章</a>
        </div>
    </div>
</div>
<div class="zxx_ad_left fixed">
    <script type="text/javascript"><!--
    google_ad_client = "pub-0090627341039040";
    /* 图片广告120x240 */
    google_ad_slot = "5742530632";
    google_ad_width = 120;
    google_ad_height = 240;
    //-->
    </script>
    <script type="text/javascript"
            src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
    </script>
</div>
<div class="zxx_ad_right fixed">
    <script type="text/javascript"><!--
    google_ad_client = "pub-0090627341039040";
    /* 图片广告120x240 */
    google_ad_slot = "5742530632";
    google_ad_width = 120;
    google_ad_height = 240;
    //-->
    </script>
    <script type="text/javascript"
            src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
    </script>
</div>
</body>
</html>
